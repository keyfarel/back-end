<?php

namespace app;

use app\controllers\RegisterController;
use app\controllers\LoginController;
use app\helpers\SessionHelper;

class Router
{
    private $routes = [
        'register' => [RegisterController::class, 'register', SessionHelper::ROLE_ADMIN],
        'login' => [LoginController::class, 'login', null],
        'admin_dashboard' => ['views/admin_dashboard.php', SessionHelper::ROLE_ADMIN],
        'user_dashboard' => ['views/user_dashboard.php', SessionHelper::ROLE_USER],
    ];

    public function route(string $page): void
    {
        SessionHelper::initSession();
        SessionHelper::checkSessionTimeout();

        if (isset($this->routes[$page])) {
            $route = $this->routes[$page];
            $roleId = $route[2] ?? null;

            if ($roleId !== null) {
                SessionHelper::redirectIfNotLoggedInOrNotAdmin($roleId);
            }

            // Periksa apakah rute adalah controller atau file view
            if (is_string($route[0])) {
                // Jika berupa view, sertakan file
                require_once __DIR__ . '/' . $route[0];
            } else {
                // Jika berupa controller, panggil method yang sesuai
                $controller = new $route[0]();
                $controller->{$route[1]}();
            }
        } else {
            // Tampilkan halaman error jika rute tidak ditemukan
            header('HTTP/1.0 404 Not Found');
            require_once __DIR__ . '/views/error.php';
        }
    }
}
