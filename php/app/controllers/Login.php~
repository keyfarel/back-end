<?php

namespace app\controllers;

use app\core\Controller;

<<<<<<< HEAD
class Login extends Controller{
=======
class Login extends Controller
{
>>>>>>> 65fb076e53b87291d11d0219e673203d300ca9f9
    public function index(): void
    {
        $this->view("main/login");
    }

    public function authentication(): void
    {
        if ($_SERVER['REQUEST_METHOD'] == 'POST') {
<<<<<<< HEAD
            $username = $_POST['username'];
            $password = $_POST['password'];
    
            //lebih baik ganti md5 ke password_bcrypt untuk keamanan
            $user = $this->model('User_Model')->getUserByUsername($username);
            if($user){
                if (md5($password) === $user['password']) {
=======
            $username = htmlspecialchars($_POST['username']);
            $password = $_POST['password'];

            //lebih baik ganti md5 ke password_bcrypt untuk keamanan
            $user = $this->model('UsersModel')->getUserByUsername($username);
            if ($user) {
                if (password_verify($password, $user['password'])) {
>>>>>>> 65fb076e53b87291d11d0219e673203d300ca9f9

                    session_start();
                    $_SESSION['user_id'] = $user['user_id'];
                    $_SESSION['username'] = $user['username'];

<<<<<<< HEAD
                    if($user['role_id'] == 1){
                        $_SESSION['role_id'] = $user['role_id'];
                        header('Location: ' . BASEURL . '/dashboardadmin');
                        die();
                    }else{
=======
                    if ($user['role_id'] == 1) {
                        $_SESSION['role_id'] = $user['role_id'];
                        header('Location: ' . BASEURL . '/dashboardadmin');
                        die();
                    } else {
>>>>>>> 65fb076e53b87291d11d0219e673203d300ca9f9
                        $_SESSION['role_id'] = $user['role_id'];
                        header('Location: ' . BASEURL . '/dashboarduser');
                        die();
                    }
<<<<<<< HEAD
                }else {
                    //kondisi jika password salah
                    echo "<script>
                            alert('password atau username salah coba lagi')
                            </script>";
                            header('Location: ' . BASEURL . '/login');
                    die();
                }
            }else {
=======
                } else {
                    echo "<script>
                            alert('password atau username salah coba lagi')
                            </script>";
                    header('Location: ' . BASEURL . '/login');
                    die();
                }
            } else {
>>>>>>> 65fb076e53b87291d11d0219e673203d300ca9f9
                header('Location: ' . BASEURL . '/login');
                die();
            }
        }
    }

<<<<<<< HEAD
    public function logout(){
=======
    public function logout(): void
    {
>>>>>>> 65fb076e53b87291d11d0219e673203d300ca9f9
        session_start();
        session_unset();
        session_destroy();

        header('Location: ' . BASEURL . '/login');
        exit;
    }
}
